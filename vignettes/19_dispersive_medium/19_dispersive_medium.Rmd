---
title: "Dispersive incident medium"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  rmarkdown::html_vignette:
    toc: true
    toc_depth: 3
    fig_width: 7
    fig_height: 3
    fig_caption: true
    includes:
      in_header: "../../inst/_x3d_header.html"
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{Dispersive incident medium}
  %\VignetteEncoding{UTF-8}
---

```{r demo, message=FALSE, echo=FALSE}
library(knitr)
library(terms)
library(dielectric)
options(cli.num_colors = 1)
theme_set(theme_grey())
opts_chunk$set(echo = FALSE, warning =FALSE,
               message=FALSE, comment='', 
               tidy=FALSE, cache = FALSE)
do.call(read_chunk, list(path = "_run.R"))
```

## Objective

Presently, TERMS assumes a constant refractive index for the incident medium. In some situations, however, the dispersion should be taken into account. 
This example illustrates a workaround, using a rescaled dielectric function for the particles. We compare the far-field cross-sections for a dimer of silver spheres, using the built-in dielectric function of [Yang et al, Phys. Rev. B 91, 235137 (2015)](https://doi.org/10.1103/PhysRevB.91.235137) stored in `Ag_PRB.txt` and dispersionless "water" ($n=1.33$), and a simulation run with rescaled values in vacuum:

- $\lambda \to \lambda/n$
- $\varepsilon \to \varepsilon/n^2$

```{r show_cluster, echo=FALSE, results='asis', message=FALSE}
library(terms)
cat('  <style>
.x3d_scene {
float:right;
margin:0em;
 }
  </style>')

ge <- get_geometry('input1')
cl <- cluster_geometry(ge)
terms::x3d_scene(cl, viewpoint=c(0,0,200), width = "200px", height = "150px") 
```

This second simulation with a user-defined dielectric function uses the following `input` file with rescaled values in vacuum.

```{bash input}
cat input2
```

```{r read, cache=FALSE}
```

## Orientation-averaged results

```{r oa}
```


The two plots are identical. To use a dispersive incident medium one would simply use $n(\lambda)$ values for water in the rescaling above.

-----

```{r cleanup}
```
_Last run: `r format(Sys.time(), '%d %B, %Y')`_
