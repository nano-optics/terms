<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Near-field map of a nano-shell dimer â€¢ terms</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../extra.css" rel="stylesheet">
<meta property="og:title" content="Near-field map of a nano-shell dimer">
<meta property="og:description" content="terms">
<meta property="og:image" content="http://nano-optics.ac.nz/terms/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><link rel="stylesheet" type="text/css" href="http://www.x3dom.org/x3dom/src/x3dom.css">
<script type="text/javascript" src="http://www.x3dom.org/x3dom/src/x3dom.js"></script><style>
.x3d_scene {
  max-width: 300px;
    width: 80%;
    height: 80%;
    margin: 1em;
    background: rgb(238,251,255);
    background: radial-gradient(circle, rgba(238,251,255,1) 0%, rgba(212,212,212,1) 100%);
 }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">terms</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../articles/Keywords.html">Keywords</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Simple examples</li>
    <li>
      <a href="../../articles/01_dimer_spheres/01_dimer_spheres.html">01 dimer spheres</a>
    </li>
    <li>
      <a href="../../articles/02_angular_dispersion/02_angular_dispersion.html">02 angular dispersion</a>
    </li>
    <li>
      <a href="../../articles/03_nearfield_coreshells/03_nearfield_coreshells.html">03 nearfield coreshells</a>
    </li>
    <li>
      <a href="../../articles/04_chiral_dimer_spheroids/04_chiral_dimer_spheroids.html">04 chiral dimer spheroids</a>
    </li>
    <li>
      <a href="../../articles/05_quadrature_averaging/05_quadrature_averaging.html">05 quadrature averaging</a>
    </li>
    <li>
      <a href="../../articles/06_dielectric_function/06_dielectric_function.html">06 dielectric function</a>
    </li>
    <li>
      <a href="../../articles/07_ldoc/07_ldoc.html">07 local degree of chirality</a>
    </li>
    <li>
      <a href="../../articles/08_polarimetry/08_polarimetry.html">08 polarimetry</a>
    </li>
    <li>
      <a href="../../articles/09_spectrum_near_field/09_spectrum_near_field.html">09 orientation-averaged near field spectrum</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Advanced examples &amp; testing</li>
    <li>
      <a href="../../articles/10_shell_absorption/10_shell_absorption.html">10 shell absorption</a>
    </li>
    <li>
      <a href="../../articles/11_convergence/11_convergence.html">11 convergence</a>
    </li>
    <li>
      <a href="../../articles/12_convergence_VTACS/12_convergence_VTACS.html">12 convergence VTACS</a>
    </li>
    <li>
      <a href="../../articles/13_masking/13_masking.html">13 masking</a>
    </li>
    <li>
      <a href="../../articles/14_diffractive_chain/14_diffractive_chain.html">14 diffractive chain</a>
    </li>
    <li>
      <a href="../../articles/15_quadrimer/15_quadrimer.html">15 quadrimer vs 2 dimers</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Technical notes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Convergence and timing studies</li>
    <li>
      <a href="../../articles/101_timing/101_timing.html">101 timing</a>
    </li>
    <li>
      <a href="../../articles/102_comparison_schemes/102_comparison_schemes.html">102 comparison of schemes</a>
    </li>
    <li>
      <a href="../../articles/104_large_separation/104_large_separation.html">104 large separation</a>
    </li>
    <li>
      <a href="../../articles/105_factorised_RTR/105_factorised_RTR.html">105 factorised RTR</a>
    </li>
    <li>
      <a href="../../articles/106_balancing/106_balancing.html">106 balancing</a>
    </li>
    <li>
      <a href="../../articles/109_individual_absorption/109_individual_absorption.html">109 individual absorption</a>
    </li>
    <li>
      <a href="../../articles/110_alpha_tensor/110_alpha_tensor.html">110 alpha tensor</a>
    </li>
    <li>
      <a href="../../articles/111_polarised_nf/111_polarised_nf.html">111 polarised OA near-fields</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Validation</li>
    <li>
      <a href="../../articles/1001_mstm_ff/1001_mstm_ff.html">1001 MSTM far-field</a>
    </li>
    <li>
      <a href="../../articles/1003_cda/1003_cda.html">1003 CDA dichroism</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="../../articles/Indexing.html">Indexing conventions</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../news/index.html">Change log</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nano-optics/terms/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Near-field map of a nano-shell dimer</h1>
            
            <h4 data-toc-skip class="date">28 January, 2022</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nano-optics/terms/blob/HEAD/vignettes/03_nearfield_coreshells/03_nearfield_coreshells.Rmd" class="external-link"><code>vignettes/03_nearfield_coreshells/03_nearfield_coreshells.Rmd</code></a></small>
      <div class="hidden name"><code>03_nearfield_coreshells.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="objective">Objective<a class="anchor" aria-label="anchor" href="#objective"></a>
</h2>
<p>This example illustrates the calculation of near-field maps at a specific wavelength. The structure consists of two core-shell spheres <code>Au@Ag</code> in water with a 1 nm gap.</p>
<style>
.x3d_scene {
float:right;
margin:0em;
 }
  </style>
<p><x3d width="200px" height="150px" class="x3d_scene"><scene><transform scale="30 30 30" rotation="0 0 -1.00001127231894 2.41593653589793" translation="-30.5 0 0"><shape><appearance><material ambientintensity="0.4" diffusecolor="0.7529412 0.7529412 0.7529412" shininess="0.16" specularcolor="0.827451 0.827451 0.827451"></material></appearance><sphere radius="1"></sphere></shape></transform><transform scale="30 30 30" rotation="0 0 -1.00001127231894 2.41593653589793" translation="30.5 0 0"><shape><appearance><material ambientintensity="0.4" diffusecolor="0.7529412 0.7529412 0.7529412" shininess="0.16" specularcolor="0.827451 0.827451 0.827451"></material></appearance><sphere radius="1"></sphere></shape></transform><shape><indexedlineset colorpervertex="false" colorindex="0 1 2" coordindex="0 1 -1 0 2 -1 0 3 -1"><coordinate point="0 0 0 100 0 0 0 100 0 0 0 100"></coordinate><color color="1 0 0 0 1 0 0.2 0.2 1"></color></indexedlineset></shape><viewpoint centerofrotation="0 0 0" position="0 0 200" orientation="0 0 1 0"></viewpoint></scene></x3d></p>
</div>
<div class="section level2">
<h2 id="far-field">Far-field<a class="anchor" aria-label="anchor" href="#far-field"></a>
</h2>
<p>We first run a far-field simulation to identify a resonance,</p>
<pre><code>ModeAndScheme 2 2
MultipoleCutoff 8
Wavelength 300 800 100
Incidence 0 0 0 1
Medium 1.7689 # for water
Verbosity 1
OutputFormat HDF5 cross_sections

# 2 spheres spaced by 1nm along x
Scatterers 2
Au@Ag -30.5 0 0 30 29
Au@Ag  30.5 0 0 30 29</code></pre>
<p><img src="03_nearfield_coreshells_files/figure-html/ff-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="near-field">Near-field<a class="anchor" aria-label="anchor" href="#near-field"></a>
</h2>
<p>Next we run a near-field simulation at 680 nm,</p>
<pre><code>ModeAndScheme 1 2
MultipoleCutoff 12
Wavelength 680
Incidence file incidence 1 # linear polarisation
Medium 1.7689 # for water
Verbosity 1
OutputFormat HDF5 map

MapQuantity 2 E # map I=|E|^2"

SpacePoints  -100   100   400   -75   75   300    0   0   1

# 2 spheres spaced by 1nm along x
Scatterers 2
Au@Ag -30.5 0 0 30 29
Au@Ag  30.5 0 0 30 29</code></pre>
<p>The command to run the example is simply</p>
<pre><code>../../build/terms input_nf &gt; log</code></pre>
<p>The full log contains basic details of the calculations, and finishes with the timing.</p>
<details closed><summary>
Show log file (click to open)
</summary><pre><code>readInputFile&gt; Parsing file input_nf

readInputFile&gt; Detected keyword ModeAndScheme
               mode=1 =&gt; mapNF at diff. lambda and diff. Inc. and Sca_angles
               scheme=2 =&gt; Seek T^(ji) using Stout's iterative scheme
readInputFile&gt; Detected keyword MultipoleCutoff
               Supplied ncut(1)= 12
               Setting ncut(2)= ncut(1)
               Setting ncut(3)=  -8
readInputFile&gt; Detected keyword Wavelength
               Wavelength (nm):   680.0000
readInputFile&gt; Detected keyword Incidence
               Incidence filename= incidence
               Expected incidence count=      2
readInputFile&gt; X-linear polarization
               Incident Euler angles and weights:
                  alpha        beta        gamma        weight
               0.00000000   0.00000000   0.00000000   0.50000000
               0.00000000   0.00000000   1.57079600   0.50000000
readInputFile&gt; Detected keyword Medium
               Constant host epsilon=  1.7689E+0
readInputFile&gt; Detected keyword Verbosity
               verbosity=     1 (Low)
readInputFile&gt; Detected keyword OutputFormat
               OutputFormat=HDF5
               All output files are stored in file "map.h5                                                          "
readInputFile&gt; Detected keyword MapQuantity
               Map enhancement |E|**p with p=   2
readInputFile&gt; Detected keyword SpacePoints
               i,lb_i,ub_i,npts_i= 1 -1.00000000000000000E+02  1.00000000000000000E+02  400
               i,lb_i,ub_i,npts_i= 2 -7.50000000000000000E+01  7.50000000000000000E+01  300
               i,lb_i,ub_i,npts_i= 3  0.00000000000000000E+00  0.00000000000000000E+00    1
               nGridPoints=    241402

readInputFile&gt; Detected keyword Scatterers
 with nscat=    2

readInputFile&gt; Descriptor(s) and circumscribing sphere(s):

 scatID String                  x          y          z         R_0
    1   Au@Ag              -3.0500E+1  0.0000E+0  0.0000E+0  3.0000E+1
    2   Au@Ag               3.0500E+1  0.0000E+0  0.0000E+0  3.0000E+1

readInputFile&gt; Individual geometry characteristic(s):

 scatID Details
    1   Mie with ncoats= 1 R_{-k}:  2.9000E+1
    2   Mie with ncoats= 1 R_{-k}:  2.9000E+1

readInputFile&gt; Dielectric functions for (coated) Mie scatterer(s):

 scatID volID Label
    1     0     Ag
    1    -1     Au
    2     0     Ag
    2    -1     Au

readInputFile&gt; Finished parsing 10 keywords


mapNF&gt; ===== Wavelength:   680.00 (nm) ======================

solve&gt; Prestaging...
solve&gt; Staging and solving/inverting...
solve&gt; Done!

calcSphBessels&gt; WARNING: ZBESJ set NZ components to zero. NZ=      3
calcSphBessels&gt; WARNING: ZBESJ set NZ components to zero. NZ=      3
calcSphBessels&gt; WARNING: ZBESJ set NZ components to zero. NZ=      3
calcSphBessels&gt; WARNING: ZBESJ set NZ components to zero. NZ=      3
calcSphBessels&gt; WARNING: ZBESJ set NZ components to zero. NZ=      3
calcSphBessels&gt; WARNING: ZBESJ set NZ components to zero. NZ=      3
calcSphBessels&gt; WARNING: ZBESJ set NZ components to zero. NZ=      3
calcSphBessels&gt; WARNING: ZBESJ set NZ components to zero. NZ=      3
mapNF&gt; Done!

termsProgram&gt; Program run time (CPU &amp; real in s):  1.566E+01  1.557E+01</code></pre>
</details><p><br></p>
The output consists of a file <code>map_E</code> which contains the near-field data.
<details closed><summary>
Show results file (click to open)
</summary><pre><code>        group        name       otype dclass        dim
0           /  Near-Field   H5I_GROUP                  
1 /Near-Field  Gridpoints H5I_DATASET  FLOAT 241402 x 3
2 /Near-Field  Incidences H5I_DATASET  FLOAT      2 x 4
3 /Near-Field Wavelengths H5I_DATASET  FLOAT          1
4 /Near-Field       map_E H5I_DATASET  FLOAT 241402 x 9</code></pre>
</details><p><br></p>
<pre><code>Rows: 241,402
Columns: 9
$ lambda &lt;dbl&gt; 680, 680, 680, 680, 680, 680, 680, 680, 680, 680, 680, 680, 680â€¦
$ x      &lt;dbl&gt; -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -10â€¦
$ y      &lt;dbl&gt; -75.0, -75.0, -74.5, -74.5, -74.0, -74.0, -73.5, -73.5, -73.0, â€¦
$ z      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, â€¦
$ scatID &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, â€¦
$ volID  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, â€¦
$ E2avg  &lt;dbl&gt; 0.9581860, 0.9581860, 0.9622476, 0.9622476, 0.9663924, 0.966392â€¦
$ E2X    &lt;dbl&gt; 0.8536298, 0.8536298, 0.8618566, 0.8618566, 0.8702688, 0.870268â€¦
$ E2Y    &lt;dbl&gt; 1.062742, 1.062742, 1.062639, 1.062639, 1.062516, 1.062516, 1.0â€¦</code></pre>
<p><img src="03_nearfield_coreshells_files/figure-html/nf-1.png" width="700"></p>
<p>Because the superposition T-matrix method does not require any discretisation of the scatterers, we can compute accurately the fields in very small regions of space, such as in the gap between the two particles, and within their thin shells. Beside the near-field information, the output also returns two variables to index the different regions and materials. This allows for easier post-processing, for example the calculation of local rate of absorption, which is proportional to <span class="math inline">\(\Im(\varepsilon)\cdot |\mathbf{E}|^2\)</span>, where <span class="math inline">\(\varepsilon(\lambda)\)</span> is the (wavelength-dependent) dielectric function of each material. The following close-up map illustrates this field distribution across the gap.</p>
<pre><code>Rows: 321,602
Columns: 8
$ lambda     &lt;dbl&gt; 680, 680, 680, 680, 680, 680, 680, 680, 680, 680, 680, 680,â€¦
$ x          &lt;dbl&gt; -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10,â€¦
$ y          &lt;dbl&gt; -10.00, -10.00, -9.95, -9.95, -9.90, -9.90, -9.85, -9.85, -â€¦
$ z          &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,â€¦
$ scatID     &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,â€¦
$ volID      &lt;dbl&gt; -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,â€¦
$ E2         &lt;dbl&gt; 20.03313, 20.03313, 20.13219, 20.13219, 20.23145, 20.23145,â€¦
$ absorption &lt;dbl&gt; 21.86938, 21.86938, 21.97752, 21.97752, 22.08589, 22.08589,â€¦</code></pre>
<p><img src="03_nearfield_coreshells_files/figure-html/nfcloseup-1.png" width="700"></p>
<hr>
<p><em>Last run: 28 January, 2022</em></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Dmitri Schebarchov, Atefeh Fazel-Najafabadi, Eric Le Ru, Baptiste AuguiÃ©.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
